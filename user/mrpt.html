

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>4.11. Multi-Reference Perturbation Theory (MRPT) &mdash; PySCF 2.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4.12. Time-dependent Hartree-Fock and Density Functional Theory" href="tddft.html" />
    <link rel="prev" title="4.10. Multi-configuration self-consistent field (MCSCF)" href="mcscf.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> PySCF
          

          
          </a>

          
            
            
              <div class="version">
                2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">1. An overview of PySCF</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">3. Quickstart</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../user.html">4. User guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="gto.html">4.1. Molecular structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="scf.html">4.2. Self-consistent field (SCF) methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="dft.html">4.3. Density functional theory (DFT)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mp.html">4.4. Second-Order Møller–Plesset Perturbation Theory (MP2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="gw.html">4.5. GW approximation</a></li>
<li class="toctree-l2"><a class="reference internal" href="ci.html">4.6. Configuration interaction (CISD and FCI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="cc.html">4.7. Coupled-cluster theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="adc.html">4.8. Algebraic diagrammatic construction (ADC) scheme</a></li>
<li class="toctree-l2"><a class="reference internal" href="agf2.html">4.9. Auxiliary second-order Green’s function perturbation theory (AGF2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mcscf.html">4.10. Multi-configuration self-consistent field (MCSCF)</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4.11. Multi-Reference Perturbation Theory (MRPT)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">4.11.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compressed-perturber-functions">4.11.2. Compressed Perturber Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#references">4.11.3. References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tddft.html">4.12. Time-dependent Hartree-Fock and Density Functional Theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="solvent.html">4.13. Solvation models</a></li>
<li class="toctree-l2"><a class="reference internal" href="qmmm.html">4.14. QM/MM methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="df.html">4.15. Density fitting (DF)</a></li>
<li class="toctree-l2"><a class="reference internal" href="pbc.html">4.16. Periodic boundary conditions</a></li>
<li class="toctree-l2"><a class="reference internal" href="eph.html">4.17. Electron Phonon Matrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="lo.html">4.18. Localized Orbitals</a></li>
<li class="toctree-l2"><a class="reference internal" href="sgx.html">4.19. Seminumerical Exchange (SGX)</a></li>
<li class="toctree-l2"><a class="reference internal" href="geomopt.html">4.20. Geometry optimization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../develop.html">5. Developer documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">6. API documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interface.html">7. Interfaces</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PySCF</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../user.html"><span class="section-number">4. </span>User guide</a> &raquo;</li>
        
      <li><span class="section-number">4.11. </span>Multi-Reference Perturbation Theory (MRPT)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/user/mrpt.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="multi-reference-perturbation-theory-mrpt">
<span id="user-mrpt"></span><h1><span class="section-number">4.11. </span>Multi-Reference Perturbation Theory (MRPT)<a class="headerlink" href="#multi-reference-perturbation-theory-mrpt" title="Permalink to this headline">¶</a></h1>
<p><em>Modules</em>: <code class="xref py py-mod docutils literal notranslate"><span class="pre">mrpt</span></code></p>
<div class="section" id="introduction">
<h2><span class="section-number">4.11.1. </span>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>A second-order perturbative energy correction can be added on top of a multireference wave function.
The MRPT module in PySCF supports the second-order N-electron valence state perturbation theory (NEVPT2) <a class="bibtex reference internal" href="#angeli2001nevpt" id="id1">[1]</a>
using the strongly contracted (SC) internal contraction scheme, <a class="bibtex reference internal" href="#angeli2001scnevpt" id="id2">[2]</a><a class="bibtex reference internal" href="#angeli2002" id="id3">[3]</a> which is an intruder-state-free MRPT.
SC-NEVPT2 can be applied to CASCI/CASSCF wave functions produced by the FCI or DMRG solvers. <a class="bibtex reference internal" href="#guo2016" id="id4">[4]</a>
The number of the CI root needs to be specified for state-specific NEVPT2 calculations with <code class="docutils literal notranslate"><span class="pre">mrpt.NEVPT(mc,root=Root_ID)</span></code>.
By default, the NEVPT2 calculation is performed for the lowest root, <cite>Root_ID=0</cite>.</p>
<p>A simple example of SC-NEVPT2 calculations with the FCI and DMRG solvers is given in <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mrpt/03-dmrg_nevpt2.py">examples/mrpt/03-dmrg_nevpt2.py</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1">#</span>
<span class="c1"># Author: Sheng Guo &lt;shengg@princeton.edu&gt;</span>
<span class="c1">#         Qiming Sun &lt;osirpt.sun@gmail.com&gt;</span>
<span class="c1">#         Seunghoon Lee &lt;seunghoonlee89@gmail.com&gt;</span>
<span class="c1">#</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">DMRG-CASCI then DMRG-NEVPT2 calculation.</span>

<span class="sd">There are two NEVPT2 implementations available for DMRG Block program.  The slow</span>
<span class="sd">version (default) strictly follows the formula presented in JCP, 117(2002), 9138</span>
<span class="sd">in which the 4-particle density matrix is explictly computed.  Typically 26</span>
<span class="sd">orbitals is the upper limit of the slow version due to the large requirements</span>
<span class="sd">on the memory usage.  The fast version employs the so called MPS-pertuber</span>
<span class="sd">technique.  It is able to handle much larger systems, up to about 30 orbitals.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span><span class="p">,</span> <span class="n">mcscf</span><span class="p">,</span> <span class="n">mrpt</span><span class="p">,</span> <span class="n">dmrgscf</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">atom</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="mf">3.5</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)],</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;sto-3g&#39;</span><span class="p">,</span><span class="n">symmetry</span><span class="o">=</span><span class="s1">&#39;d2h&#39;</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="c1">##############################################################################</span>
<span class="c1">#</span>
<span class="c1"># FCI-based CASCI + NEVPT2.  Two roots are computed.  mc.ci holds the two CI</span>
<span class="c1"># wave functions.  Root ID needs to be specified for the state-specific NEVPT2</span>
<span class="c1"># calculation.  By default the lowest root is computed.</span>
<span class="c1">#</span>
<span class="c1">##############################################################################</span>
<span class="n">mc</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASCI</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">fcisolver</span><span class="o">.</span><span class="n">nroots</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">mc</span><span class="o">.</span><span class="n">fix_spin_</span><span class="p">(</span><span class="n">shift</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">ss</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="n">ci_nevpt_e1</span> <span class="o">=</span> <span class="n">mrpt</span><span class="o">.</span><span class="n">NEVPT</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="n">ci_nevpt_e2</span> <span class="o">=</span> <span class="n">mrpt</span><span class="o">.</span><span class="n">NEVPT</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;FCI NEVPT correlation E = </span><span class="si">%.15g</span><span class="s1"> </span><span class="si">%.15g</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ci_nevpt_e1</span><span class="p">,</span> <span class="n">ci_nevpt_e2</span><span class="p">))</span>

<span class="c1">##################################################</span>
<span class="c1">#</span>
<span class="c1"># DMRG-NEVPT2 fast version</span>
<span class="c1"># Use compressed MPS as perturber functions for SC-NEVPT2.</span>
<span class="c1"># 4-particle density matrix is not computed.</span>
<span class="c1">#</span>
<span class="c1">##################################################</span>

<span class="n">mc</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASCI</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">dmrgscf</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">MPIPREFIX</span> <span class="o">=</span><span class="s1">&#39;&#39;</span>
<span class="n">mc</span><span class="o">.</span><span class="n">fcisolver</span> <span class="o">=</span> <span class="n">dmrgscf</span><span class="o">.</span><span class="n">DMRGCI</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">maxM</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">fcisolver</span><span class="o">.</span><span class="n">nroots</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">mc</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="n">mps_nevpt_e1</span> <span class="o">=</span> <span class="n">mrpt</span><span class="o">.</span><span class="n">NEVPT</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">compress_approx</span><span class="p">(</span><span class="n">maxM</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="n">mps_nevpt_e2</span> <span class="o">=</span> <span class="n">mrpt</span><span class="o">.</span><span class="n">NEVPT</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">compress_approx</span><span class="p">(</span><span class="n">maxM</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MPS NEVPT correlation E = </span><span class="si">%.15g</span><span class="s1"> </span><span class="si">%.15g</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mps_nevpt_e1</span><span class="p">,</span> <span class="n">mps_nevpt_e2</span><span class="p">,))</span>
</pre></div>
</div>
<p>which outputs</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FCI</span> <span class="n">NEVPT</span> <span class="n">correlation</span> <span class="n">E</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0655576579894365</span> <span class="o">-</span><span class="mf">0.0913916717329482</span>
<span class="n">MPS</span> <span class="n">NEVPT</span> <span class="n">correlation</span> <span class="n">E</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0655570680554582</span> <span class="o">-</span><span class="mf">0.0913913618723217</span>
</pre></div>
</div>
<p>namely, the second-order correlation energies for the ground and the first-excited states
with the FCI solver, and those with the DMRG solver.</p>
</div>
<div class="section" id="compressed-perturber-functions">
<h2><span class="section-number">4.11.2. </span>Compressed Perturber Functions<a class="headerlink" href="#compressed-perturber-functions" title="Permalink to this headline">¶</a></h2>
<p>The bottleneck in SC-NEVPT2 is the evaluation of the energies of the perturber functions,
where up to the 4-particle reduced density matrix (4-RDM) appears.
In DMRG-SC-NEVPT2, this evaluation is done with the compressed bond dimension (M’) which is smaller than
the bond dimension in the DMRG energy optimization to avoid the bottleneck.
It can be specified by <code class="docutils literal notranslate"><span class="pre">mrpt.NEVPT(mc,root=Root_ID).compress_approx(maxM=M')</span></code>.</p>
<p>More information can be found in Reference <a class="bibtex reference internal" href="#guo2016" id="id5">[4]</a></p>
</div>
<div class="section" id="references">
<h2><span class="section-number">4.11.3. </span>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p id="bibtex-bibliography-user/mrpt-0"><dl class="citation">
<dt class="bibtex label" id="angeli2001nevpt"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Celestino Angeli, Renzo Cimiraglia, S Evangelisti, T Leininger, and J-P Malrieu. Introduction of n-electron valence states for multireference perturbation theory. <em>J. Chem. Phys.</em>, 114(23):10252–10264, 2001. <a class="reference external" href="https://doi.org/10.1063/1.1361246">doi:10.1063/1.1361246</a>.</p>
</dd>
<dt class="bibtex label" id="angeli2001scnevpt"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>Celestino Angeli, Renzo Cimiraglia, and Jean-Paul Malrieu. N-electron valence state perturbation theory: a fast implementation of the strongly contracted variant. <em>Chem. Phys. Lett.</em>, 350(3-4):297–305, 2001. <a class="reference external" href="https://doi.org/10.1016/S0009-2614(01)01303-3">doi:10.1016/S0009-2614(01)01303-3</a>.</p>
</dd>
<dt class="bibtex label" id="angeli2002"><span class="brackets"><a class="fn-backref" href="#id3">3</a></span></dt>
<dd><p>Celestino Angeli, Renzo Cimiraglia, and Jean-Paul Malrieu. N-electron valence state perturbation theory: a spinless formulation and an efficient implementation of the strongly contracted and of the partially contracted variants. <em>J. Chem. Phys.</em>, 117(20):9138–9153, 2002. <a class="reference external" href="https://doi.org/10.1063/1.1515317">doi:10.1063/1.1515317</a>.</p>
</dd>
<dt class="bibtex label" id="guo2016"><span class="brackets">4</span><span class="fn-backref">(<a href="#id4">1</a>,<a href="#id5">2</a>)</span></dt>
<dd><p>Sheng Guo, Mark A Watson, Weifeng Hu, Qiming Sun, and Garnet Kin-Lic Chan. N-electron valence state perturbation theory based on a density matrix renormalization group reference function, with applications to the chromium dimer and a trimer model of poly (p-phenylenevinylene). <em>J. Chem. Theory Comput.</em>, 12(4):1583–1591, 2016. <a class="reference external" href="https://doi.org/10.1021/acs.jctc.5b01225">doi:10.1021/acs.jctc.5b01225</a>.</p>
</dd>
</dl>
</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="tddft.html" class="btn btn-neutral float-right" title="4.12. Time-dependent Hartree-Fock and Density Functional Theory" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="mcscf.html" class="btn btn-neutral float-left" title="4.10. Multi-configuration self-consistent field (MCSCF)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2015-2021, The PySCF Developers.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
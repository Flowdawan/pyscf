

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>4.10. Multi-configuration self-consistent field (MCSCF) &mdash; PySCF 2.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4.11. Multi-Reference Perturbation Theory (MRPT)" href="mrpt.html" />
    <link rel="prev" title="4.9. Auxiliary second-order Green’s function perturbation theory (AGF2)" href="agf2.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> PySCF
          

          
          </a>

          
            
            
              <div class="version">
                2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">1. An overview of PySCF</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">3. Quickstart</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../user.html">4. User guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="gto.html">4.1. Molecular structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="scf.html">4.2. Self-consistent field (SCF) methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="dft.html">4.3. Density functional theory (DFT)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mp.html">4.4. Second-Order Møller–Plesset Perturbation Theory (MP2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="gw.html">4.5. GW approximation</a></li>
<li class="toctree-l2"><a class="reference internal" href="ci.html">4.6. Configuration interaction (CISD and FCI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="cc.html">4.7. Coupled-cluster theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="adc.html">4.8. Algebraic diagrammatic construction (ADC) scheme</a></li>
<li class="toctree-l2"><a class="reference internal" href="agf2.html">4.9. Auxiliary second-order Green’s function perturbation theory (AGF2)</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4.10. Multi-configuration self-consistent field (MCSCF)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">4.10.1. Introduction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#casci">4.10.1.1. CASCI</a></li>
<li class="toctree-l4"><a class="reference internal" href="#casscf">4.10.1.2. CASSCF</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#picking-an-active-space">4.10.2. Picking an Active Space</a></li>
<li class="toctree-l3"><a class="reference internal" href="#frozen-orbital-mcscf">4.10.3. Frozen-orbital MCSCF</a></li>
<li class="toctree-l3"><a class="reference internal" href="#state-averaged-calculations">4.10.4. State-Averaged Calculations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#job-control">4.10.5. Job Control</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#optimization-settings">4.10.5.1. Optimization Settings</a></li>
<li class="toctree-l4"><a class="reference internal" href="#initial-guess">4.10.5.2. Initial Guess</a></li>
<li class="toctree-l4"><a class="reference internal" href="#restarting">4.10.5.3. Restarting</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#observables-and-properties">4.10.6. Observables and Properties</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#wave-function-analysis">4.10.6.1. Wave Function Analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#natural-orbitals">4.10.6.2. Natural Orbitals</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#references">4.10.7. References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="mrpt.html">4.11. Multi-Reference Perturbation Theory (MRPT)</a></li>
<li class="toctree-l2"><a class="reference internal" href="tddft.html">4.12. Time-dependent Hartree-Fock and Density Functional Theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="solvent.html">4.13. Solvation models</a></li>
<li class="toctree-l2"><a class="reference internal" href="qmmm.html">4.14. QM/MM methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="df.html">4.15. Density fitting (DF)</a></li>
<li class="toctree-l2"><a class="reference internal" href="pbc.html">4.16. Periodic boundary conditions</a></li>
<li class="toctree-l2"><a class="reference internal" href="eph.html">4.17. Electron Phonon Matrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="lo.html">4.18. Localized Orbitals</a></li>
<li class="toctree-l2"><a class="reference internal" href="sgx.html">4.19. Seminumerical Exchange (SGX)</a></li>
<li class="toctree-l2"><a class="reference internal" href="geomopt.html">4.20. Geometry optimization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../develop.html">5. Developer documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">6. API documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interface.html">7. Interfaces</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PySCF</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../user.html"><span class="section-number">4. </span>User guide</a> &raquo;</li>
        
      <li><span class="section-number">4.10. </span>Multi-configuration self-consistent field (MCSCF)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/user/mcscf.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="multi-configuration-self-consistent-field-mcscf">
<span id="user-mcscf"></span><h1><span class="section-number">4.10. </span>Multi-configuration self-consistent field (MCSCF)<a class="headerlink" href="#multi-configuration-self-consistent-field-mcscf" title="Permalink to this headline">¶</a></h1>
<p><em>Modules</em>: <code class="xref py py-mod docutils literal notranslate"><span class="pre">mcscf</span></code></p>
<div class="section" id="introduction">
<h2><span class="section-number">4.10.1. </span>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Multiconfigurational self-consistent field (MCSCF) methods go beyond the single-determinant Hartree-Fock (HF) method by allowing the wave function to become a linear combination of multiple determinants.
While the configurations i.e. determinants can in principle be chosen in an arbitrary number of ways, PySCF focuses on the complete active space (CAS) family of methods, where the set of electron configurations is defined in terms of a given set of active orbitals, also known as the “active space”.
The CAS method generates all possible electron configurations that can be formed from the set of the active orbitals, and is therefore equivalent to an FCI procedure on a subset of the molecular orbitals; please see <a class="reference internal" href="ci.html#theory-ci"><span class="std std-numref">Section 4.6</span></a> for a discussion on the FCI method.
The use of MCSCF methods is crucial for reliable modeling of systems that exhibit nearly degenerate orbitals i.e. static correlation, such as transition metal complexes.
For a detailed discussion of MCSCF methods, we direct the reader to References <a class="bibtex reference internal" href="#helgaker2013" id="id1">[1]</a> and <a class="bibtex reference internal" href="#esqc" id="id2">[2]</a>.</p>
<p>The MCSCF module has two main flavors: CASCI and CASSCF.
In CASCI, the wave function is written as a linear combination of Slater determinants, and the expansion coefficients are solved in a variational procedure.
The orbitals are fixed in a CASCI calculation.
In contrast, in a CASSCF calculation, the orbitals are relaxed to minimize the resulting CASCI energy.
This means performing multiple CASCI steps followed by updates to the molecular orbitals, in analogy to Hartree-Fock calculations which also relies on iterative algorithms to minimize the HF energy with respect to the orbitals.</p>
<p>Minimal examples for each type of calculations are shown below.</p>
<div class="section" id="casci">
<h3><span class="section-number">4.10.1.1. </span>CASCI<a class="headerlink" href="#casci" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">mp</span><span class="p">,</span> <span class="n">mcscf</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span>
    <span class="n">atom</span> <span class="o">=</span> <span class="s1">&#39;O 0 0 0; O 0 0 1.2&#39;</span><span class="p">,</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;ccpvdz&#39;</span><span class="p">,</span>
    <span class="n">spin</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">myhf</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">RHF</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="c1"># Use MP2 natural orbitals to define the active space for the single-point CAS-CI calculation</span>
<span class="n">mymp</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">UMP2</span><span class="p">(</span><span class="n">myhf</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="n">noons</span><span class="p">,</span> <span class="n">natorbs</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">make_natural_orbitals</span><span class="p">(</span><span class="n">mymp</span><span class="p">)</span>
<span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASCI</span><span class="p">(</span><span class="n">myhf</span><span class="p">,</span> <span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">natorbs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="casscf">
<h3><span class="section-number">4.10.1.2. </span>CASSCF<a class="headerlink" href="#casscf" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyscf</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">pyscf</span><span class="o">.</span><span class="n">M</span><span class="p">(</span>
    <span class="n">atom</span> <span class="o">=</span> <span class="s1">&#39;O 0 0 0; O 0 0 1.2&#39;</span><span class="p">,</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;ccpvdz&#39;</span><span class="p">,</span>
    <span class="n">spin</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">myhf</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">RHF</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
 <span class="c1"># We can also run CAS calculations starting from the Hartree-Fock orbitals.</span>
 <span class="n">mycas</span> <span class="o">=</span> <span class="n">myhf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Like many other modules in PySCF, <code class="xref py py-mod docutils literal notranslate"><span class="pre">mcscf</span></code> works with density-fitting (<a class="reference internal" href="df.html#user-df"><span class="std std-numref">Section 4.15</span></a>) and x2c (<a class="reference internal" href="scf.html#user-x2c"><span class="std std-numref">Section 4.2.8</span></a>).
It can also be used in its unrestricted formulation, please see <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/60-uhf_based_ucasscf.py">examples/mcscf/60-uhf_based_ucasscf.py</a> for an example.
An important feature of <code class="xref py py-mod docutils literal notranslate"><span class="pre">mcscf</span></code> is that it can interface with external CI solver such as DMRG, FCIQMC, or selected CI methods, see the external projects for more details.
You can even use MP2 or CC methods as solvers!
Check out <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master//examples/cc/42-as_casci_fcisolver.py">/examples/cc/42-as_casci_fcisolver.py</a> for a working example.</p>
</div>
</div>
<div class="section" id="picking-an-active-space">
<h2><span class="section-number">4.10.2. </span>Picking an Active Space<a class="headerlink" href="#picking-an-active-space" title="Permalink to this headline">¶</a></h2>
<p>In general, selecting an active space can be cumbersome and PySCF offers severals ways to facilitate this process.
There are several strategies and they all contain two main components:</p>
<ul class="simple">
<li><p>Specify the number of electrons and orbitals in the active space.</p></li>
<li><p>(Optional) Specify the which orbitals are “active”</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We always advise users to visualize their chosen active orbitals before starting large/expensive calculations.
This involves dumping the MO coefficients to a <code class="docutils literal notranslate"><span class="pre">molden</span></code> file (see example <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/tools/02-molden.py">examples/tools/02-molden.py</a>) and visualizing with your chosen program.
While there are many great softwares available to visualize orbitals, <a class="reference external" href="http://jmol.sourceforge.net/">JMol</a> is one of the easiest to use and is recommended for less experienced users.</p>
</div>
<p>Below is a list of several general strategies one could employ to pick active space orbitals:</p>
<ol class="arabic simple">
<li><p>(Default) Specifying no additional information.</p></li>
</ol>
<blockquote>
<div><p>This is the most minimal strategy for selecting an active space and chooses orbitals (and electrons) around the Fermi level that match the number of orbitals and electrons specified by the user.
In most circumstances, this is not an ideal strategy and will lead to poor convergence or none at all.</p>
<p>For example:</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="n">mycas</span> <span class="o">=</span> <span class="n">myhf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<blockquote>
<div><p>Hartree-Fock orbitals are often poor for systems with significant static correlation.
In such cases, orbitals from density functional calculations often yield better starting points for CAS calculations.</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Specifying the active space orbitals as a list of molecular orbital (MO) indices.</p></li>
</ol>
<blockquote>
<div><blockquote>
<div><p>This is often useful combined with a visual analysis of localized orbitals (see the section on localized orbitals).</p>
</div></blockquote>
<p>The user can select the MO orbital indices “manually” and pass them to the <code class="docutils literal notranslate"><span class="pre">sort_mo</span></code> function. NB! The orbitals are numbered from 1, not 0.
See <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/10-define_cas_space.py">examples/mcscf/10-define_cas_space.py</a> and <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/34-init_guess_localization.py">examples/mcscf/34-init_guess_localization.py</a> for more details.</p>
</div></blockquote>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">myhf</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="c1"># Note sort_mo by default take the 1-based orbital indices.</span>
<span class="n">mo</span> <span class="o">=</span> <span class="n">mycas</span><span class="o">.</span><span class="n">sort_mo</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">])</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">mo</span><span class="p">)</span>
</pre></div>
</div>
<p>3) Specifying the number of orbitals in each symmetry group.
This strategy is often helpful when the system has a high degree of symmetry, or when there is no physically evident best choise for the active orbitals.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">ncore</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;A1g&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;A1u&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">}</span>
<span class="n">ncas</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;A1g&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;A1u&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;E1ux&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;E1uy&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;E1gx&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;E1gy&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;E2ux&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;E2uy&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;E2gx&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;E2gy&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
<span class="n">mo</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">sort_mo_by_irrep</span><span class="p">(</span><span class="n">mycas</span><span class="p">,</span> <span class="n">mf</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">,</span> <span class="n">ncas</span><span class="p">,</span> <span class="n">ncore</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">mo</span><span class="p">)</span>
</pre></div>
</div>
<p>A similar approach where we specify the number of electrons in each irreducible representation is also possible by setting <code class="docutils literal notranslate"><span class="pre">mycas.fcisolver.irrep_nelec</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">myhf</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">fcisolver</span><span class="o">.</span><span class="n">irrep_nelec</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;A1g&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;A1u&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;E1ux&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;E1uy&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This strategy is often combined with calculations at a lower level of theory.
For instance, MP2 or CISD natural orbitals and their occupation numbers can be used determine the suitable active space in each symmetry block.
Natural orbitals with occupations close to 2 are strongly occupied, and can be frozen in the CAS calculation.
Natural orbitals with small occupation numbers can likewise be omitted from the active space.</p>
</div>
<p>4) Use automated strategies (<code class="docutils literal notranslate"><span class="pre">avas</span></code> and <code class="docutils literal notranslate"><span class="pre">dmet_cas</span></code>) to pick an active space based on AO orbitals you’re targeting.
For more details, see <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/43-avas.py">examples/mcscf/43-avas.py</a> and <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/43-dmet_cas.py">examples/mcscf/43-dmet_cas.py</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyscf.mcscf</span> <span class="kn">import</span> <span class="n">avas</span>
<span class="n">ao_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Fe 3d&#39;</span><span class="p">,</span> <span class="s1">&#39;Fe 4d&#39;</span><span class="p">,</span> <span class="s1">&#39;C 2pz&#39;</span><span class="p">]</span>
<span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">,</span> <span class="n">orbs</span> <span class="o">=</span> <span class="n">avas</span><span class="o">.</span><span class="n">avas</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">ao_labels</span><span class="p">)</span>
<span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyscf.mcscf</span> <span class="kn">import</span> <span class="n">dmet_cas</span>
<span class="n">ao_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Fe 3d&#39;</span><span class="p">,</span> <span class="s1">&#39;Fe 4d&#39;</span><span class="p">,</span> <span class="s1">&#39;C 2pz&#39;</span><span class="p">]</span>
<span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">,</span> <span class="n">mo</span> <span class="o">=</span> <span class="n">dmet_cas</span><span class="o">.</span><span class="n">guess_cas</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">mf</span><span class="o">.</span><span class="n">make_rdm1</span><span class="p">(),</span> <span class="n">ao_labels</span><span class="p">)</span>
<span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">mo</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="frozen-orbital-mcscf">
<h2><span class="section-number">4.10.3. </span>Frozen-orbital MCSCF<a class="headerlink" href="#frozen-orbital-mcscf" title="Permalink to this headline">¶</a></h2>
<p>Orbitals can be frozen in the orbital optimization to e.g. reduce the computational effort of CASSCF calculations.
The orbitals will remain fixed throughout the optimization.</p>
<p>Users can specify the number of lowest orbitals to freeze:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">myhf</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">frozen</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
<p>Users can also specify a list of orbital indices (0-based).
These may be occupied, virtual, or active orbitals.</p>
<p>See <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/19-frozen_core.py">examples/mcscf/19-frozen_core.py</a> for a complete example.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <cite>frozen</cite> keyword of the CASSCF optimizer should not be confused with the <cite>frozen</cite> keyword of the FCI solver, which controls the number of orbitals that are constrained to be doubly occupied.</p>
</div>
</div>
<div class="section" id="state-averaged-calculations">
<h2><span class="section-number">4.10.4. </span>State-Averaged Calculations<a class="headerlink" href="#state-averaged-calculations" title="Permalink to this headline">¶</a></h2>
<p>When your system has states that are close-by in energy, their ordering may change during the orbital optimization and result in non-convergence of the CASSCF optimization.
In such cases it is often helpful to optimize the orbitals for a state average.
The <code class="docutils literal notranslate"><span class="pre">state_average_</span></code> function (note the hanging underscore) is a member function of <code class="docutils literal notranslate"><span class="pre">CASCI</span></code>/<code class="docutils literal notranslate"><span class="pre">CASSCF</span></code> objects and takes the weights of the states as input.
The weights can be any normalized and non-negative array of values, but equal weights are typically used.
See Section 12.7.2 in Ref. <a class="bibtex reference internal" href="#helgaker2013" id="id3">[1]</a> for more details.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">n_states</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_states</span><span class="p">)</span><span class="o">/</span><span class="n">n_states</span>
<span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">state_average_</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/15-state_average.py">examples/mcscf/15-state_average.py</a> for a complete example.</p>
<p>By default, only a single spin and/or point group symmetry is targeted, but it is possible to target a mixture of both:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">]</span>
<span class="n">solver1</span> <span class="o">=</span> <span class="n">fci</span><span class="o">.</span><span class="n">direct_spin1_symm</span><span class="o">.</span><span class="n">FCI</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">solver1</span><span class="o">.</span><span class="n">wfnsym</span><span class="o">=</span> <span class="s1">&#39;A1&#39;</span>
<span class="n">solver1</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">solver2</span> <span class="o">=</span> <span class="n">fci</span><span class="o">.</span><span class="n">direct_spin1_symm</span><span class="o">.</span><span class="n">FCI</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">solver2</span><span class="o">.</span><span class="n">wfnsym</span><span class="o">=</span> <span class="s1">&#39;A2&#39;</span>
<span class="n">solver2</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">mcscf</span><span class="o">.</span><span class="n">state_average_mix_</span><span class="p">(</span><span class="n">mycas</span><span class="p">,</span> <span class="p">[</span><span class="n">solver1</span><span class="p">,</span> <span class="n">solver2</span><span class="p">],</span> <span class="n">weights</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/41-state_average.py">examples/mcscf/41-state_average.py</a> for a complete example.</p>
</div>
<div class="section" id="job-control">
<h2><span class="section-number">4.10.5. </span>Job Control<a class="headerlink" href="#job-control" title="Permalink to this headline">¶</a></h2>
<div class="section" id="optimization-settings">
<h3><span class="section-number">4.10.5.1. </span>Optimization Settings<a class="headerlink" href="#optimization-settings" title="Permalink to this headline">¶</a></h3>
<p>For CASSCF calculations, users may want to modify several of the convergence thresholds such as the energy (<code class="docutils literal notranslate"><span class="pre">conv_tol</span></code>), the orbital gradient (<code class="docutils literal notranslate"><span class="pre">conv_tol_grad</span></code>), and the maximum number of MCSCF iterations (<code class="docutils literal notranslate"><span class="pre">max_cycle_macro</span></code>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">conv_tol</span> <span class="o">=</span> <span class="mf">1e-12</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">conv_tol_grad</span> <span class="o">=</span> <span class="mf">1e-6</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">max_cycle_macro</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="initial-guess">
<h3><span class="section-number">4.10.5.2. </span>Initial Guess<a class="headerlink" href="#initial-guess" title="Permalink to this headline">¶</a></h3>
<p>Initial guess orbitals for the CASSCF calculation (starting orbitals) may be passed to the <code class="docutils literal notranslate"><span class="pre">kernel</span></code> member function of an MCSCF object.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">myhf</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">my_custom_mos</span><span class="p">)</span>
</pre></div>
</div>
<p>CI coefficients from a previous calculation can also be passed as an initial guess to expedite the calculation:</p>
<p>Examples:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/14-project_init_guess.py">examples/mcscf/14-project_init_guess.py</a></p></li>
<li><p><a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/31-cr2_scan/cr2-scan.py">examples/mcscf/31-cr2_scan/cr2-scan.py</a></p></li>
<li><p><a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/34-init_guess_localization.py">examples/mcscf/34-init_guess_localization.py</a></p></li>
<li><p><a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/43-avas.py">examples/mcscf/43-avas.py</a></p></li>
<li><p><a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/43-dmet_cas.py">examples/mcscf/43-dmet_cas.py</a></p></li>
</ul>
</div>
<div class="section" id="restarting">
<h3><span class="section-number">4.10.5.3. </span>Restarting<a class="headerlink" href="#restarting" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When running large calculations, it’s always recommended that you specify a checkpoint file for your calculation.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mycas</span><span class="o">.</span><span class="n">chkfile</span> <span class="o">=</span> <span class="s2">&quot;casscf.chk&quot;</span>
</pre></div>
</div>
<p>Much like <a class="reference internal" href="../modules/scf.html#module-scf" title="scf: restricted and unrestricted, closed shell and open shell Hartree-Fock methods"><code class="xref py py-mod docutils literal notranslate"><span class="pre">scf</span></code></a>, if a job is interrupted, users can restart the MCSCF calculations using checkpoint files from a crashed calculation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyscf.lib</span> <span class="kn">import</span> <span class="n">chkfile</span>
<span class="n">old_chk_file</span> <span class="o">=</span> <span class="s2">&quot;old_casscf.chk&quot;</span>
<span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">),</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">chkfile</span> <span class="o">=</span> <span class="s2">&quot;restarted_casscf.chk&quot;</span>
<span class="n">mo</span> <span class="o">=</span> <span class="n">chkfile</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">old_chk_file</span><span class="p">,</span> <span class="s1">&#39;mcscf/mo_coeff&#39;</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">mo</span><span class="p">)</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/13-restart.py">examples/mcscf/13-restart.py</a> for a complete example.</p>
<p>Restarting calculations can be also be useful when using results from a smaller active space to speed up calculations on a larger one.</p>
</div>
</div>
<div class="section" id="observables-and-properties">
<h2><span class="section-number">4.10.6. </span>Observables and Properties<a class="headerlink" href="#observables-and-properties" title="Permalink to this headline">¶</a></h2>
<div class="section" id="wave-function-analysis">
<h3><span class="section-number">4.10.6.1. </span>Wave Function Analysis<a class="headerlink" href="#wave-function-analysis" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">analyze</span></code> member functions of MCSCF objects prints many useful properties to <code class="docutils literal notranslate"><span class="pre">stdout</span></code> when the verbosity is &gt;=4.</p>
<ol class="arabic simple">
<li><p>Natural orbital occupancies</p></li>
<li><p>Natural orbital AO expansions</p></li>
<li><p>Overlap between canonical MCSCF orbitals and the initial guess orbitals.</p></li>
<li><p>Analysis of the CI coefficients, i.e. the leading configurations and their weights</p></li>
<li><p>AO populations</p></li>
<li><p>Atomic populations</p></li>
<li><p>AO spin densities (if applicable)</p></li>
<li><p>Atomic spin densities (if applicable)</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mycas</span> <span class="o">=</span> <span class="n">myhf</span><span class="o">.</span><span class="n">CASCI</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">analyze</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="natural-orbitals">
<h3><span class="section-number">4.10.6.2. </span>Natural Orbitals<a class="headerlink" href="#natural-orbitals" title="Permalink to this headline">¶</a></h3>
<p>The CAS wave function is invariant under orbital rotation within the inactive core, active, and inactive virtual spaces.
The inactive core and virtual orbitals are by default canonicalized, i.e., they are transformed by block-diagonalizing the generalized Fock matrix within the inactive core and virtual subblocks.
This also yields energy eigenvalues for the inactive core and virtual orbitals.
In contrast, no energy or electron occupation can be assigned to the active orbitals, strictly speaking.
The user may request the active orbitals to be transformed to the so-called natural representation, in which the reduced one-body density matrix is diagonal, and the formal natural orbital occupation numbers can be found on its diagonal.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When <code class="docutils literal notranslate"><span class="pre">mycas.natorb</span></code> is set, the natural orbitals may NOT be sorted by the active space occupancy.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">myhf</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">natorb</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="references">
<h2><span class="section-number">4.10.7. </span>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p id="bibtex-bibliography-user/mcscf-0"><dl class="citation">
<dt class="bibtex label" id="helgaker2013"><span class="brackets">1</span><span class="fn-backref">(<a href="#id1">1</a>,<a href="#id3">2</a>)</span></dt>
<dd><p>Trygve Helgaker, Poul Jorgensen, and Jeppe Olsen. <em>Molecular Electronic-Structure Theory</em>. Wiley, 2013. ISBN 9781118531471.</p>
</dd>
<dt class="bibtex label" id="esqc"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>Esqc lectures 2019. URL: <a class="reference external" href="http://www.esqc.org/?page=lectures">http://www.esqc.org/?page=lectures</a>.</p>
</dd>
</dl>
</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="mrpt.html" class="btn btn-neutral float-right" title="4.11. Multi-Reference Perturbation Theory (MRPT)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="agf2.html" class="btn btn-neutral float-left" title="4.9. Auxiliary second-order Green’s function perturbation theory (AGF2)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2015-2021, The PySCF Developers.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
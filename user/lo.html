

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>4.18. Localized Orbitals &mdash; PySCF 2.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4.19. Seminumerical Exchange (SGX)" href="sgx.html" />
    <link rel="prev" title="4.17. Electron Phonon Matrix" href="eph.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> PySCF
          

          
          </a>

          
            
            
              <div class="version">
                2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">1. An overview of PySCF</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">3. Quickstart</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../user.html">4. User guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="gto.html">4.1. Molecular structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="scf.html">4.2. Self-consistent field (SCF) methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="dft.html">4.3. Density functional theory (DFT)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mp.html">4.4. Second-Order Møller–Plesset Perturbation Theory (MP2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="gw.html">4.5. GW approximation</a></li>
<li class="toctree-l2"><a class="reference internal" href="ci.html">4.6. Configuration interaction (CISD and FCI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="cc.html">4.7. Coupled-cluster theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="adc.html">4.8. Algebraic diagrammatic construction (ADC) scheme</a></li>
<li class="toctree-l2"><a class="reference internal" href="agf2.html">4.9. Auxiliary second-order Green’s function perturbation theory (AGF2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mcscf.html">4.10. Multi-configuration self-consistent field (MCSCF)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mrpt.html">4.11. Multi-Reference Perturbation Theory (MRPT)</a></li>
<li class="toctree-l2"><a class="reference internal" href="tddft.html">4.12. Time-dependent Hartree-Fock and Density Functional Theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="solvent.html">4.13. Solvation models</a></li>
<li class="toctree-l2"><a class="reference internal" href="qmmm.html">4.14. QM/MM methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="df.html">4.15. Density fitting (DF)</a></li>
<li class="toctree-l2"><a class="reference internal" href="pbc.html">4.16. Periodic boundary conditions</a></li>
<li class="toctree-l2"><a class="reference internal" href="eph.html">4.17. Electron Phonon Matrix</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4.18. Localized Orbitals</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">4.18.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#references">4.18.2. References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="sgx.html">4.19. Seminumerical Exchange (SGX)</a></li>
<li class="toctree-l2"><a class="reference internal" href="geomopt.html">4.20. Geometry optimization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../develop.html">5. Developer documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">6. API documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interface.html">7. Interfaces</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PySCF</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../user.html"><span class="section-number">4. </span>User guide</a> &raquo;</li>
        
      <li><span class="section-number">4.18. </span>Localized Orbitals</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/user/lo.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="localized-orbitals">
<span id="user-lo"></span><h1><span class="section-number">4.18. </span>Localized Orbitals<a class="headerlink" href="#localized-orbitals" title="Permalink to this headline">¶</a></h1>
<p><em>Modules</em>: <code class="xref py py-mod docutils literal notranslate"><span class="pre">lo</span></code></p>
<div class="section" id="introduction">
<h2><span class="section-number">4.18.1. </span>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>A molecular orbital is usually delocalized, i.e. it has non-negligible amplitude over the whole system rather than only around a specific region localized around some atom(s) or bond(s).
However, one can choose a unitary rotation <span class="math notranslate nohighlight">\(U\)</span></p>
<div class="math notranslate nohighlight">
\[\phi = \psi U\]</div>
<p>such that the resulting
orbitals <span class="math notranslate nohighlight">\(\phi\)</span> are as spatially localized as possible. This is typically achieved by one of two classes of
methods.
The first is to project the orbitals onto a predefined local set of orbitals, which can be e.g. atomic orbitals or pseudo-atomic orbitals.
The second is to optimize a cost function <span class="math notranslate nohighlight">\(f\)</span>, which measures the locality of the molecular orbitals.
Because there is no unambiguous choice for the localization criterion, several criteria have been suggested.
Boys localization minimizes the spread of the orbital</p>
<div class="math notranslate nohighlight">
\[f(U) = \sum_{i} \langle\psi_i|r^2|\psi_i\rangle - \langle\psi_i|r|\psi_i\rangle^2\]</div>
<p>Boys localized orbitals <a class="bibtex reference internal" href="#foster60" id="id1">[1]</a> in periodic systems are typically termed maximally localized
Wannier orbitals (MLWF) <a class="bibtex reference internal" href="#marzari97" id="id2">[2]</a>.</p>
<p>Pipek-Mezey (PM) localization <a class="bibtex reference internal" href="#pipek98" id="id3">[3]</a> maximizes the population charges on the atoms</p>
<div class="math notranslate nohighlight">
\[f(U) = \sum^{\mathrm{atoms}}_{I} \sum_{i} \left|q^{I}_{i} \right|^2\]</div>
<p>Note that PM localization depends on the choice of atomic orbitals used for
the population analysis. Several choices of populations are available, e.g.
Mulliken or based on (meta-) L&quot;owdin orbitals.
Intrinsic bond orbitals (IBOs) can be viewed as a special case of PM
localization using intrinsic atomic orbitals (IAOs) as population method.
See Ref. <a class="bibtex reference internal" href="#lehtola14pm" id="id4">[4]</a> for a summary of choices of orbitals.
Note that PM localization preserves the separation between  <span class="math notranslate nohighlight">\(\sigma\)</span> and <span class="math notranslate nohighlight">\(\pi\)</span> orbitals.</p>
<p>Edmiston-Ruedenberg (ER) localization <a class="bibtex reference internal" href="#edmiston63" id="id5">[5]</a> maximizes the orbital Coulomb self-repulsion,</p>
<div class="math notranslate nohighlight">
\[f(U) = \sum_{i} (ii|ii)\]</div>
<p>ER localization, however, is computationally more expensive than the Boys or PM approaches.</p>
<p>Localized orbitals can be calculated via the pivoted Cholesky factorization of a density-like
matrix <span class="math notranslate nohighlight">\(\mathbf{D} = \mathbf{C} \mathbf{C}^\dagger\)</span>. <a class="bibtex reference internal" href="#aquilante06" id="id6">[6]</a> Since <span class="math notranslate nohighlight">\(\mathbf{C}\)</span> is
generally a rectangular matrix containing only the subset of <span class="math notranslate nohighlight">\(N\)</span> orbitals intended for localization,
the matrix <span class="math notranslate nohighlight">\(\mathbf{D}\)</span> is positive-semidefinite. It can be factored using a Cholesky decomposition
with full column pivoting,</p>
<div class="math notranslate nohighlight">
\[\mathbf{P}^\dagger \mathbf{D} \mathbf{P} = \mathbf{L} \mathbf{L}^\dagger ,\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf{L}\)</span> is a lower triangular matrix and <span class="math notranslate nohighlight">\(\mathbf{P}\)</span> is a permutation matrix.
In the end, the <span class="math notranslate nohighlight">\(N\)</span> leftmost columns of <span class="math notranslate nohighlight">\(\mathbf{P L}\)</span> are taken as the localized orbitals.
While Cholesky orbitals are usually not as localized as, for example, PM or Boys orbitals, the procedure
is non-iterative and produces unique result, except possibly for the impact of degeneracies.
Cholesky orbitals can serve as an excellent guess for iterative localization procedures.</p>
<p>A summary of the functionality of the <code class="xref py py-mod docutils literal notranslate"><span class="pre">lo</span></code> module is given below:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 28%" />
<col style="width: 15%" />
<col style="width: 21%" />
<col style="width: 8%" />
<col style="width: 27%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Method</p></td>
<td><p>optimization</p></td>
<td><p>cost function</p></td>
<td><p>PBC</p></td>
<td><p>ref</p></td>
</tr>
<tr class="row-even"><td><p>(meta-) L&quot;owdin</p></td>
<td><p>No</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>yes</p></td>
<td><p><a class="bibtex reference internal" href="#lowdin50" id="id7">[7]</a><a class="bibtex reference internal" href="#sun14qmmm" id="id8">[8]</a></p></td>
</tr>
<tr class="row-odd"><td><p>Natural atomic orbitals</p></td>
<td><p>No</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>gamma</p></td>
<td><p><a class="bibtex reference internal" href="#reed85" id="id9">[9]</a></p></td>
</tr>
<tr class="row-even"><td><p>Intrinsic atomic orbitals</p></td>
<td><p>No</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>yes</p></td>
<td><p><a class="bibtex reference internal" href="#knizia13iao" id="id10">[10]</a></p></td>
</tr>
<tr class="row-odd"><td><p>Cholesky orbitals</p></td>
<td><p>No</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>no</p></td>
<td><p><a class="bibtex reference internal" href="#aquilante06" id="id11">[6]</a></p></td>
</tr>
<tr class="row-even"><td><p>Boys</p></td>
<td><p>yes</p></td>
<td><p>dipole</p></td>
<td><p>no</p></td>
<td><p><a class="bibtex reference internal" href="#foster60" id="id12">[1]</a></p></td>
</tr>
<tr class="row-odd"><td><p>Pipek-Mezey</p></td>
<td><p>yes</p></td>
<td><p>local charges</p></td>
<td><p>gamma</p></td>
<td><p><a class="bibtex reference internal" href="#pipek98" id="id13">[3]</a></p></td>
</tr>
<tr class="row-even"><td><p>Intrinsic bond orbitals</p></td>
<td><p>yes</p></td>
<td><p>IAO charges</p></td>
<td><p>gamma</p></td>
<td><p><a class="bibtex reference internal" href="#knizia13iao" id="id14">[10]</a></p></td>
</tr>
<tr class="row-odd"><td><p>Edmiston-Ruedenberg</p></td>
<td><p>yes</p></td>
<td><p>coulomb integral</p></td>
<td><p>gamma</p></td>
<td><p><a class="bibtex reference internal" href="#edmiston63" id="id15">[5]</a></p></td>
</tr>
</tbody>
</table>
<p>For example, to obtain the natural atomic orbital coefficients (in terms
of the original atomic orbitals):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span><span class="p">,</span> <span class="n">lo</span>

<span class="n">x</span> <span class="o">=</span> <span class="o">.</span><span class="mi">63</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
                  <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span> <span class="p">,</span>  <span class="n">x</span><span class="p">,</span>  <span class="n">x</span><span class="p">)],</span>
                  <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">,</span>  <span class="n">x</span><span class="p">)],</span>
                  <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span>  <span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">)],</span>
                  <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">)]],</span>
            <span class="n">basis</span><span class="o">=</span><span class="s1">&#39;ccpvtz&#39;</span><span class="p">)</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="c1"># C matrix stores the AO to localized orbital coefficients</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">lo</span><span class="o">.</span><span class="n">orth_ao</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="s1">&#39;nao&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="references">
<h2><span class="section-number">4.18.2. </span>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p id="bibtex-bibliography-user/lo-0"><dl class="citation">
<dt class="bibtex label" id="foster60"><span class="brackets">1</span><span class="fn-backref">(<a href="#id1">1</a>,<a href="#id12">2</a>)</span></dt>
<dd><p>J. M. Foster and S. F. Boys. Canonical Configurational Interaction Procedure. <em>Rev. Mod. Phys.</em>, 32(2):300–302, 1960.</p>
</dd>
<dt class="bibtex label" id="marzari97"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>N. Marzari and D. Vanderbilt. Maximally Localized Generalized Wannier Functions for Composite Energy Bands. <em>Phys. Rev. B</em>, 56(20):12847–12865, 1997.</p>
</dd>
<dt class="bibtex label" id="pipek98"><span class="brackets">3</span><span class="fn-backref">(<a href="#id3">1</a>,<a href="#id13">2</a>)</span></dt>
<dd><p>János Pipek and Paul G. Mezey. A fast intrinsic localization procedure applicable for ab-initio and semiempirical linear combination of atomic orbital wave functions. <em>J. Chem. Phys.</em>, 90(9):4916, 1998.</p>
</dd>
<dt class="bibtex label" id="lehtola14pm"><span class="brackets"><a class="fn-backref" href="#id4">4</a></span></dt>
<dd><p>Susi Lehtola and Hannes Jónsson. Pipek–mezey orbital localization using various partial charge estimates. <em>Journal of chemical theory and computation</em>, 10(2):642–649, 2014.</p>
</dd>
<dt class="bibtex label" id="edmiston63"><span class="brackets">5</span><span class="fn-backref">(<a href="#id5">1</a>,<a href="#id15">2</a>)</span></dt>
<dd><p>Clyde Edmiston and Klaus Ruedenberg. Localized Atomic and Molecular Orbitals. <em>Rev. Mod. Phys.</em>, 35(3):457–464, 1963.</p>
</dd>
<dt class="bibtex label" id="aquilante06"><span class="brackets">6</span><span class="fn-backref">(<a href="#id6">1</a>,<a href="#id11">2</a>)</span></dt>
<dd><p>Francesco Aquilante, Thomas Bondo Pedersen, Alfredo Sánchez de Merás, and Henrik Koch. Fast noniterative orbital localization for large molecules. <em>J. Chem. Phys.</em>, 125(17):174101, 2006. <a class="reference external" href="https://doi.org/10.1063/1.2360264">doi:10.1063/1.2360264</a>.</p>
</dd>
<dt class="bibtex label" id="lowdin50"><span class="brackets"><a class="fn-backref" href="#id7">7</a></span></dt>
<dd><p>Per-Olov Löwdin. On the Non-Orthogonality Problem Connected with the Use of Atomic Wave Functions in the Theory of Molecules and Crystals. <em>J. Chem. Phys.</em>, 18(3):365, 1950.</p>
</dd>
<dt class="bibtex label" id="sun14qmmm"><span class="brackets"><a class="fn-backref" href="#id8">8</a></span></dt>
<dd><p>Qiming Sun and Garnet Kin-Lic Chan. Exact and optimal quantum mechanics/molecular mechanics boundaries. <em>J. Chem. Theory Comput.</em>, 10:3784, 2014.</p>
</dd>
<dt class="bibtex label" id="reed85"><span class="brackets"><a class="fn-backref" href="#id9">9</a></span></dt>
<dd><p>Alan E. Reed, Robert B. Weinstock, and Frank Weinhold. Natural population analysis. <em>J. Chem. Phys.</em>, 83(2):735–746, 1985.</p>
</dd>
<dt class="bibtex label" id="knizia13iao"><span class="brackets">10</span><span class="fn-backref">(<a href="#id10">1</a>,<a href="#id14">2</a>)</span></dt>
<dd><p>Gerald Knizia. Intrinsic Atomic Orbitals: An Unbiased Bridge between Quantum Theory and Chemical Concepts. <em>J. Chem. Theory Comput.</em>, 9(11):4834–4843, 2013.</p>
</dd>
</dl>
</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="sgx.html" class="btn btn-neutral float-right" title="4.19. Seminumerical Exchange (SGX)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="eph.html" class="btn btn-neutral float-left" title="4.17. Electron Phonon Matrix" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2015-2021, The PySCF Developers.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>


<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>7.2. geomopt — Geometry optimization &mdash; PySCF 1.7.6 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="7.3. dmrgscf — DMRG and DMRG-SCF/CASSCF" href="dmrgscf.html" />
    <link rel="prev" title="7.1. dftd3 — DFT with D3 dispersion correction" href="dftd3.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> PySCF
          

          
          </a>

          
            
            
              <div class="version">
                1.7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">1. An overview of PySCF</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">3. Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user.html">4. User guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop.html">5. Developer documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">6. API documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../interface.html">7. Interfaces</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="dftd3.html">7.1. <code class="xref py py-mod docutils literal notranslate"><span class="pre">dftd3</span></code> — DFT with D3 dispersion correction</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">7.2. <code class="xref py py-mod docutils literal notranslate"><span class="pre">geomopt</span></code> — Geometry optimization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#examples">7.2.1. Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-pyscf.geomopt.berny_solver">7.2.2. Program reference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="dmrgscf.html">7.3. <code class="xref py py-mod docutils literal notranslate"><span class="pre">dmrgscf</span></code> — DMRG and DMRG-SCF/CASSCF</a></li>
<li class="toctree-l2"><a class="reference internal" href="fciqmcscf.html">7.4. <code class="xref py py-mod docutils literal notranslate"><span class="pre">fciqmcscf</span></code> — Full configuration interaction quantum Monte Carlo (FCIQMC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="cornell_shci.html">7.5. <code class="xref py py-mod docutils literal notranslate"><span class="pre">cornell_shci</span></code> — Semistochastic heat-bath configuration interaction (SHCI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="shciscf.html">7.6. <code class="xref py py-mod docutils literal notranslate"><span class="pre">shciscf</span></code> — Semistochastic heat bath configuration interaction (SHCI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="icmpspt.html">7.7. <code class="xref py py-mod docutils literal notranslate"><span class="pre">icmpspt</span></code> — Internal-contracted MPS perturbation method</a></li>
<li class="toctree-l2"><a class="reference internal" href="nao.html">7.8. <code class="xref py py-mod docutils literal notranslate"><span class="pre">nao</span></code> — Numerical Atomic Orbitals</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PySCF</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../interface.html"><span class="section-number">7. </span>Interfaces</a> &raquo;</li>
        
      <li><span class="section-number">7.2. </span><code class="xref py py-mod docutils literal notranslate"><span class="pre">geomopt</span></code> — Geometry optimization</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/interface/geomopt.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="geomopt-geometry-optimization">
<span id="geomopt"></span><h1><span class="section-number">7.2. </span><code class="xref py py-mod docutils literal notranslate"><span class="pre">geomopt</span></code> — Geometry optimization<a class="headerlink" href="#geomopt-geometry-optimization" title="Permalink to this headline">¶</a></h1>
<p>The <code class="xref py py-mod docutils literal notranslate"><span class="pre">geomopt</span></code> module implements geometry optimization via
interfaces to <a class="reference external" href="https://github.com/leeping/geomeTRIC">geomeTRIC</a>
and <a class="reference external" href="https://github.com/jhrmnn/pyberny">PyBerny</a>.
The following example shows how to optimize the structure of N<sub>2</sub> molecule with PyBerny:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span>
<span class="kn">from</span> <span class="nn">pyscf.geomopt.berny_solver</span> <span class="kn">import</span> <span class="n">optimize</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="s1">&#39;N 0 0 0; N 0 0 1.2&#39;</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s1">&#39;ccpvdz&#39;</span><span class="p">)</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">mol_eq</span> <span class="o">=</span> <span class="n">optimize</span><span class="p">(</span><span class="n">mf</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mol_eq</span><span class="o">.</span><span class="n">atom_coords</span><span class="p">())</span>
</pre></div>
</div>
<div class="section" id="examples">
<h2><span class="section-number">7.2.1. </span>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/geomopt/01-geomeTRIC.py">examples/geomopt/01-geomeTRIC.py</a></p></li>
<li><p><a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/geomopt/01-pyberny.py">examples/geomopt/01-pyberny.py</a></p></li>
<li><p><a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/geomopt/02-as_pyscf_method.py">examples/geomopt/02-as_pyscf_method.py</a></p></li>
<li><p><a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/geomopt/10-with_qmmm.py">examples/geomopt/10-with_qmmm.py</a></p></li>
<li><p><a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/geomopt/11-with_ghost_atom.py">examples/geomopt/11-with_ghost_atom.py</a></p></li>
<li><p><a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/geomopt/12-excited_states.py">examples/geomopt/12-excited_states.py</a></p></li>
<li><p><a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/geomopt/12-mcscf_excited_states.py">examples/geomopt/12-mcscf_excited_states.py</a></p></li>
<li><p><a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/geomopt/13-ccsd_t.py">examples/geomopt/13-ccsd_t.py</a></p></li>
<li><p><a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/geomopt/14-with_solvent.py">examples/geomopt/14-with_solvent.py</a></p></li>
<li><p><a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/geomopt/15-tddft_with_solvent.py">examples/geomopt/15-tddft_with_solvent.py</a></p></li>
<li><p><a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/geomopt/20-callback.py">examples/geomopt/20-callback.py</a></p></li>
</ul>
</div>
<div class="section" id="module-pyscf.geomopt.berny_solver">
<span id="program-reference"></span><h2><span class="section-number">7.2.2. </span>Program reference<a class="headerlink" href="#module-pyscf.geomopt.berny_solver" title="Permalink to this headline">¶</a></h2>
<p>Interface to geometry optimizer pyberny <a class="reference external" href="https://github.com/jhrmnn/pyberny">https://github.com/jhrmnn/pyberny</a></p>
<dl class="py class">
<dt id="pyscf.geomopt.berny_solver.GeometryOptimizer">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">pyscf.geomopt.berny_solver.</span></code><code class="sig-name descname"><span class="pre">GeometryOptimizer</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">method</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pyscf/geomopt/berny_solver.html#GeometryOptimizer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyscf.geomopt.berny_solver.GeometryOptimizer" title="Permalink to this definition">¶</a></dt>
<dd><p>Optimize the molecular geometry for the input method.</p>
<p>Note the method.mol will be changed after calling .kernel() method.</p>
<dl class="py method">
<dt id="pyscf.geomopt.berny_solver.GeometryOptimizer.kernel">
<code class="sig-name descname"><span class="pre">kernel</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pyscf/geomopt/berny_solver.html#GeometryOptimizer.kernel"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyscf.geomopt.berny_solver.GeometryOptimizer.kernel" title="Permalink to this definition">¶</a></dt>
<dd><p>Kernel function is the main driver of a method.  Every method should
define the kernel function as the entry of the calculation.  Note the
return value of kernel function is not strictly defined.  It can be
anything related to the method (such as the energy, the wave-function,
the DFT mesh grids etc.).</p>
</dd></dl>

<dl class="py method">
<dt id="pyscf.geomopt.berny_solver.GeometryOptimizer.optimize">
<code class="sig-name descname"><span class="pre">optimize</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyscf.geomopt.berny_solver.GeometryOptimizer.optimize" title="Permalink to this definition">¶</a></dt>
<dd><p>Kernel function is the main driver of a method.  Every method should
define the kernel function as the entry of the calculation.  Note the
return value of kernel function is not strictly defined.  It can be
anything related to the method (such as the energy, the wave-function,
the DFT mesh grids etc.).</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt id="pyscf.geomopt.berny_solver.kernel">
<code class="sig-prename descclassname"><span class="pre">pyscf.geomopt.berny_solver.</span></code><code class="sig-name descname"><span class="pre">kernel</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">method</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">assert_convergence</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_ghost</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">callback</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pyscf/geomopt/berny_solver.html#kernel"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyscf.geomopt.berny_solver.kernel" title="Permalink to this definition">¶</a></dt>
<dd><p>Optimize geometry with pyberny for the given method.</p>
<p>To adjust the convergence threshold, parameters can be set in kwargs as
below:</p>
</dd></dl>

<dl class="py function">
<dt id="pyscf.geomopt.berny_solver.optimize">
<code class="sig-prename descclassname"><span class="pre">pyscf.geomopt.berny_solver.</span></code><code class="sig-name descname"><span class="pre">optimize</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">method</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">assert_convergence</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_ghost</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">callback</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pyscf/geomopt/berny_solver.html#optimize"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyscf.geomopt.berny_solver.optimize" title="Permalink to this definition">¶</a></dt>
<dd><p>Optimize geometry with pyberny for the given method.</p>
<p>To adjust the convergence threshold, parameters can be set in kwargs as
below:</p>
</dd></dl>

<dl class="py function">
<dt id="pyscf.geomopt.berny_solver.to_berny_log">
<code class="sig-prename descclassname"><span class="pre">pyscf.geomopt.berny_solver.</span></code><code class="sig-name descname"><span class="pre">to_berny_log</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pyscf_log</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pyscf/geomopt/berny_solver.html#to_berny_log"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyscf.geomopt.berny_solver.to_berny_log" title="Permalink to this definition">¶</a></dt>
<dd><p>Adapter to allow pyberny to use pyscf.logger</p>
</dd></dl>

<span class="target" id="module-pyscf.geomopt.addons"></span><p>Helper functions for geometry optimizer</p>
<dl class="py function">
<dt id="pyscf.geomopt.addons.as_pyscf_method">
<code class="sig-prename descclassname"><span class="pre">pyscf.geomopt.addons.</span></code><code class="sig-name descname"><span class="pre">as_pyscf_method</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scan_function</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pyscf/geomopt/addons.html#as_pyscf_method"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyscf.geomopt.addons.as_pyscf_method" title="Permalink to this definition">¶</a></dt>
<dd><p>Creat an wrapper for the given scan_function, to make it work as a
pyscf gradients scanner. The wrapper can be passed to <code class="xref py py-func docutils literal notranslate"><span class="pre">optimize()</span></code>.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>scan_function : [mol] =&gt; (e_tot, grad)</p>
</dd>
</dl>
<p>Examples::
&gt;&gt;&gt; mol = gto.M(atom=’H; H 1 1.2’, basis=’ccpvdz’)
&gt;&gt;&gt; scan_fn = scf.RHF(mol).nuc_grad_method().as_scanner()
&gt;&gt;&gt; m = as_pyscf_method(mol, scan_fn)
&gt;&gt;&gt; pyscf.geomopt.berny_solver.kernel(m)</p>
</dd></dl>

<dl class="py function">
<dt id="pyscf.geomopt.addons.dump_mol_geometry">
<code class="sig-prename descclassname"><span class="pre">pyscf.geomopt.addons.</span></code><code class="sig-name descname"><span class="pre">dump_mol_geometry</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_coords</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pyscf/geomopt/addons.html#dump_mol_geometry"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyscf.geomopt.addons.dump_mol_geometry" title="Permalink to this definition">¶</a></dt>
<dd><p>Dump the molecular geometry (new_coords) and the displacement wrt old
geometry.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>new_coords (ndarray) : Cartesian coordinates in Angstrom</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pyscf.geomopt.addons.symmetrize">
<code class="sig-prename descclassname"><span class="pre">pyscf.geomopt.addons.</span></code><code class="sig-name descname"><span class="pre">symmetrize</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coords</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pyscf/geomopt/addons.html#symmetrize"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pyscf.geomopt.addons.symmetrize" title="Permalink to this definition">¶</a></dt>
<dd><p>Symmetrize the structure of a molecule.</p>
</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="dmrgscf.html" class="btn btn-neutral float-right" title="7.3. dmrgscf — DMRG and DMRG-SCF/CASSCF" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="dftd3.html" class="btn btn-neutral float-left" title="7.1. dftd3 — DFT with D3 dispersion correction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2015-2021, The PySCF Developers.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>


<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>4.17. Electron Phonon Matrix &mdash; PySCF 2.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4.18. Localized Orbitals" href="lo.html" />
    <link rel="prev" title="4.16.4. Mixing PBC and molecular modules" href="pbc/mix_mol.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> PySCF
          

          
          </a>

          
            
            
              <div class="version">
                2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">1. An overview of PySCF</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">3. Quickstart</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../user.html">4. User guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="gto.html">4.1. Molecular structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="scf.html">4.2. Self-consistent field (SCF) methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="dft.html">4.3. Density functional theory (DFT)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mp.html">4.4. Second-Order Møller–Plesset Perturbation Theory (MP2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="gw.html">4.5. GW approximation</a></li>
<li class="toctree-l2"><a class="reference internal" href="ci.html">4.6. Configuration interaction (CISD and FCI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="cc.html">4.7. Coupled-cluster theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="adc.html">4.8. Algebraic diagrammatic construction (ADC) scheme</a></li>
<li class="toctree-l2"><a class="reference internal" href="agf2.html">4.9. Auxiliary second-order Green’s function perturbation theory (AGF2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mcscf.html">4.10. Multi-configuration self-consistent field (MCSCF)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mrpt.html">4.11. Multi-Reference Perturbation Theory (MRPT)</a></li>
<li class="toctree-l2"><a class="reference internal" href="tddft.html">4.12. Time-dependent Hartree-Fock and Density Functional Theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="solvent.html">4.13. Solvation models</a></li>
<li class="toctree-l2"><a class="reference internal" href="qmmm.html">4.14. QM/MM methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="df.html">4.15. Density fitting (DF)</a></li>
<li class="toctree-l2"><a class="reference internal" href="pbc.html">4.16. Periodic boundary conditions</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4.17. Electron Phonon Matrix</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">4.17.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#spin-symmetry">4.17.2. Spin symmetry</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#analytical-eph-matrix-elements">4.17.2.1. Analytical eph matrix elements</a></li>
<li class="toctree-l4"><a class="reference internal" href="#finite-difference">4.17.2.2. Finite difference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#output-control">4.17.3. Output control</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#filtering-noisy-frequencies">4.17.3.1. Filtering noisy frequencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#matrix-element-representation">4.17.3.2. Matrix element representation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#references">4.17.4. References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="lo.html">4.18. Localized Orbitals</a></li>
<li class="toctree-l2"><a class="reference internal" href="sgx.html">4.19. Seminumerical Exchange (SGX)</a></li>
<li class="toctree-l2"><a class="reference internal" href="geomopt.html">4.20. Geometry optimization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../develop.html">5. Developer documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">6. API documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interface.html">7. Interfaces</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PySCF</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../user.html"><span class="section-number">4. </span>User guide</a> &raquo;</li>
        
      <li><span class="section-number">4.17. </span>Electron Phonon Matrix</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/user/eph.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="electron-phonon-matrix">
<span id="user-eph"></span><h1><span class="section-number">4.17. </span>Electron Phonon Matrix<a class="headerlink" href="#electron-phonon-matrix" title="Permalink to this headline">¶</a></h1>
<p><em>Modules</em>: <a class="reference internal" href="../modules/eph.html#module-eph" title="eph"><code class="xref py py-mod docutils literal notranslate"><span class="pre">eph</span></code></a>, <code class="xref py py-mod docutils literal notranslate"><span class="pre">pbc.eph</span></code></p>
<div class="section" id="introduction">
<h2><span class="section-number">4.17.1. </span>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Because nuclei are much heavier than the electrons, one usually assumes that the Born-Oppenheimer (BO) approximation holds and that the full wave function factorizes in the electronic and the nuclear wave function.
This approximation hugely simplifies the computation of the full wave function and its properties, but the approximation can break down when there is significant vibronic coupling.
Traditionally, vibronic coupling is evaluated with complex mathematical machinery, which often yields unrealistic results for large systems.
However, if one relaxes the BO approximation and assumes that the electrons experience the moving nuclei as a perturbation of the potential, the full Hamiltonian can be approximated by a Taylor expansion with the adiabatic states at equilibrium and the quantized vibrational modes.
This approach is widely used in solid state calculations for modeling electron/phonon transport properties (see <a class="bibtex reference internal" href="#giustino2017eph" id="id1">[1]</a> for more discussions).</p>
<p>PySCF supports first order eph matrix calculation by either Coupled Perturbed Kohn-Sham/Hartree-Fock (CPKS/CPHF) or finite difference. In periodic system, only FFTDF-based Gamma-point calculation is supported with finite difference. In both cases, a geometrically relaxed structure is required, or the structure instability could lead to imaginary vibrational modes.</p>
<p>A minimal example of analytical eph matrix calculation is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span><span class="p">,</span> <span class="n">eph</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span>
<span class="n">atom</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.000000000000</span><span class="p">,</span>  <span class="o">-</span><span class="mf">0.000000000775</span><span class="p">,</span>   <span class="mf">0.923671924285</span><span class="p">]],</span>
        <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.00000000000</span><span class="p">,</span>  <span class="o">-</span><span class="mf">1.432564848017</span><span class="p">,</span>   <span class="mf">2.125164039823</span><span class="p">]],</span>
        <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.000000000000</span><span class="p">,</span>   <span class="mf">1.432564848792</span><span class="p">,</span>   <span class="mf">2.125164035930</span><span class="p">]]],</span>
<span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;sto3g&#39;</span><span class="p">,</span>
<span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;Bohr&#39;</span>
<span class="p">)</span>
<span class="c1"># Note that this is a pre-computed relaxed molecule</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="n">myeph</span> <span class="o">=</span> <span class="n">eph</span><span class="o">.</span><span class="n">EPH</span><span class="p">(</span><span class="n">mf</span><span class="p">)</span>
<span class="n">ephmat</span><span class="p">,</span> <span class="n">omega</span> <span class="o">=</span> <span class="n">myeph</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;eph matrix&#39;</span><span class="p">,</span> <span class="n">ephmat</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;phonon frequencies&#39;</span><span class="p">,</span> <span class="n">omega</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively, one can compute the matrix elements using finite difference:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span><span class="p">,</span> <span class="n">eph</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span>
<span class="n">atom</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.000000000000</span><span class="p">,</span>  <span class="o">-</span><span class="mf">0.000000000775</span><span class="p">,</span>   <span class="mf">0.923671924285</span><span class="p">]],</span>
        <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.000000000000</span><span class="p">,</span>  <span class="o">-</span><span class="mf">1.432564848017</span><span class="p">,</span>   <span class="mf">2.125164039823</span><span class="p">]],</span>
        <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.000000000000</span><span class="p">,</span>   <span class="mf">1.432564848792</span><span class="p">,</span>   <span class="mf">2.125164035930</span><span class="p">]]],</span>
<span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;sto3g&#39;</span><span class="p">,</span>
<span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;Bohr&#39;</span>
<span class="p">)</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="n">ephmat</span><span class="p">,</span> <span class="n">omega</span> <span class="o">=</span> <span class="n">eph</span><span class="o">.</span><span class="n">eph_df</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;eph matrix&#39;</span><span class="p">,</span> <span class="n">ephmat</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;phonon frequencies&#39;</span><span class="p">,</span> <span class="n">omega</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="spin-symmetry">
<h2><span class="section-number">4.17.2. </span>Spin symmetry<a class="headerlink" href="#spin-symmetry" title="Permalink to this headline">¶</a></h2>
<p>The eph module in PySCF supports mean field methods including Hartree Fock and DFT using either spin-restricted or spin-unrestricted reference.</p>
<div class="section" id="analytical-eph-matrix-elements">
<h3><span class="section-number">4.17.2.1. </span>Analytical eph matrix elements<a class="headerlink" href="#analytical-eph-matrix-elements" title="Permalink to this headline">¶</a></h3>
<p>The module-level <code class="docutils literal notranslate"><span class="pre">eph.EPH(mf)</span></code> constructor can infer the correct method based
on the type of the mf argument.  For more explicit
control or inspection, the respective classes and functions can be found in
<code class="docutils literal notranslate"><span class="pre">rhf.py</span></code>, <code class="docutils literal notranslate"><span class="pre">uhf.py</span></code>, <code class="docutils literal notranslate"><span class="pre">rks.py</span></code> and <code class="docutils literal notranslate"><span class="pre">uks.py</span></code>.</p>
<p>For example, a spin-unrestricted calculation can be performed
as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">myeph</span> <span class="o">=</span> <span class="n">eph</span><span class="o">.</span><span class="n">uhf</span><span class="o">.</span><span class="n">EPH</span><span class="p">(</span><span class="n">mf</span><span class="p">)</span>
<span class="n">ephmat</span><span class="p">,</span> <span class="n">omega</span> <span class="o">=</span> <span class="n">myeph</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;eph matrix&#39;</span><span class="p">,</span> <span class="n">ephmat</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;phonon frequencies&#39;</span><span class="p">,</span> <span class="n">omega</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="finite-difference">
<h3><span class="section-number">4.17.2.2. </span>Finite difference<a class="headerlink" href="#finite-difference" title="Permalink to this headline">¶</a></h3>
<p>The finite difference kernel function <code class="docutils literal notranslate"><span class="pre">eph.eph_fd.kernel</span></code> can handle all the supported mean field methods above.</p>
</div>
</div>
<div class="section" id="output-control">
<h2><span class="section-number">4.17.3. </span>Output control<a class="headerlink" href="#output-control" title="Permalink to this headline">¶</a></h2>
<div class="section" id="filtering-noisy-frequencies">
<h3><span class="section-number">4.17.3.1. </span>Filtering noisy frequencies<a class="headerlink" href="#filtering-noisy-frequencies" title="Permalink to this headline">¶</a></h3>
<p>The diagonalization of the mass-weighted hessian can sometimes yield unphysical vibrational modes that correspond to imaginary frequencies or to non-zero frequencies which should strictly vanish. These unphysical modes may arise either from the use of not fully relaxed geometries, the use of insufficiently accurate density functional quadrature, or simply numerical noise. By default, modes below 80 cm-1 are filtered out in PySCF; note that this also includes any negative frequencies.</p>
<p>One can specify a different cutoff frequency (in cm-1) when constructing the EPH object as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">myeph</span> <span class="o">=</span> <span class="n">eph</span><span class="o">.</span><span class="n">EPH</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">cutoff_frequency</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="n">ephmat</span><span class="p">,</span> <span class="n">omega</span> <span class="o">=</span> <span class="n">myeph</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
<p>Similarly, to keep the imaginary frequencies, one can set keep_imag_frequency to True when initializing the object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">myeph</span> <span class="o">=</span> <span class="n">eph</span><span class="o">.</span><span class="n">EPH</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">keep_imag_frequency</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ephmat</span><span class="p">,</span> <span class="n">omega</span> <span class="o">=</span> <span class="n">myeph</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="matrix-element-representation">
<h3><span class="section-number">4.17.3.2. </span>Matrix element representation<a class="headerlink" href="#matrix-element-representation" title="Permalink to this headline">¶</a></h3>
<p>The eph matrix is computed in the atomic orbital (AO) basis by default. One can also request it in the MO basis as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">myeph</span> <span class="o">=</span> <span class="n">eph</span><span class="o">.</span><span class="n">EPH</span><span class="p">(</span><span class="n">mf</span><span class="p">)</span>
<span class="n">ephmat</span><span class="p">,</span> <span class="n">omega</span> <span class="o">=</span> <span class="n">myeph</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">mo_rep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="references">
<h2><span class="section-number">4.17.4. </span>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p id="bibtex-bibliography-user/eph-0"><dl class="citation">
<dt class="bibtex label" id="giustino2017eph"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Feliciano Giustino. Electron-phonon interactions from first principles. <em>Rev. Mod. Phys.</em>, 89:015003, 2017.</p>
</dd>
</dl>
</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="lo.html" class="btn btn-neutral float-right" title="4.18. Localized Orbitals" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="pbc/mix_mol.html" class="btn btn-neutral float-left" title="4.16.4. Mixing PBC and molecular modules" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2015-2021, The PySCF Developers.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>